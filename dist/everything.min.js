!function(){"use strict";function a(a){var b=a.changedTouches[0];e(a,a.type,b.clientX,b.clientY)}function b(a){f=!0,e(a,"touchstart",a.clientX,a.clientY)}function c(a){f&&e(a,"touchmove",a.clientX,a.clientY)}function d(a){f=!1,e(a,"touchend",a.clientX,a.clientY)}function e(a,b,c,d){a.preventDefault(),handleDragEvent(b,c,d)}var f=!1;document.addEventListener("touchstart",a,!0),document.addEventListener("touchmove",a,!0),document.addEventListener("touchend",a,!0),document.addEventListener("touchcancel",a,!0),document.addEventListener("touchleave",a,!0),document.addEventListener("mousedown",b,!0),document.addEventListener("mousemove",c,!0),document.addEventListener("mouseup",d,!0)}(),angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[["-","-","","","B","","","-","-"],["-","","","B","B","B","","","-"],["","","B","B","B","B","B","",""],["","B","B","B","B","B","B","B",""],["","","","","","","","",""],["","R","R","R","R","R","R","R",""],["","","R","R","R","R","R","",""],["-","","","R","R","R","","","-"],["-","-","","","R","","","-","-"]]}function b(a){return 0===a?"R":"B"}function c(a){return 0===a?"B":"R"}function d(a){for(var b=[0,0],c=0;9>c;c++)for(var d=a[c],e=0;9>e;e++)"B"===d[e]?b[0]++:"R"===d[e]&&b[1]++;return b}function e(a){var b=d(a);return b[0]<3&&b[1]<3?!0:!1}function f(a,b){if(b.length>0)return"";var c=d(a);return c[0]>=3&&c[1]>=3?"":c[0]>=3&&c[1]<3?"B":c[1]>=3&&c[0]<3?"R":void 0}function g(a,b,c,d,e){for(var f=[],g=Math.max(b-2,0),h=Math.min(b+2,8),i=Math.max(c-2,0),j=Math.min(c+2,8),k=g;h>=k;k++)for(var l=i;j>=l;l++)try{var m=p(a,b,c,k,l,d,e);f.push(m)}catch(n){}return f}function h(a,c,d){var e,f,h=[],i=b(d);for(e=0;9>e;e++)for(f=0;9>f;f++)a[e][f]===i&&(h=h.concat(g(a,e,f,c,d)));return h}function i(a,c,d){for(var e=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}],f=[],g=b(d),h=0;h<c.length;h++)for(var i=c[h].row,j=c[h].col,k=0;k<e.length;k++){var l=e[k],m=i+l.r,n=j+l.c,o=i-l.r,p=j-l.c;a[m]&&a[m][n]===g&&a[o]&&a[o][p]===g&&f.push({row:m,col:n},{row:o,col:p})}return f}function j(a,c,d){var e=b(d),f=[];if(a[4][4]===e)return[{row:4,col:4}];if(c.length>0)return i(a,c,d);for(var g=0;9>g;g++)for(var h=0;9>h;h++)a[g][h]===e&&f.push({row:g,col:h});return f}function k(a,b,c,d,e){for(var f=g(a,b,c,d,e),h=[],i=0;i<f.length;i++){var j=f[i];h.push({row:j[2].set.value.to_row,col:j[2].set.value.to_col})}return h}function l(a,b,d,e,f,g){var h=e-b,i=f-d,j=0===h?0:h/Math.abs(h),k=0===i?0:i/Math.abs(i),l=b+j,m=d+k;if(Math.abs(h)>1||Math.abs(i)>1){var n=h+i;return 4>=n&&n%2===0&&a[l]&&a[l][m]===c(g)?!0:!1}return!0}function m(a,b,c,d){for(var e=0;e<d.length;e++){var f=d[e];if(b===f.row&&c===f.col)return!0}return!1}function n(a,b,d,e){for(var f=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}],g=c(e),h=0;h<f.length;h++){var i=f[h];if(a[b+i.r]&&a[b+i.r][d+i.c]===g&&a[b-i.r]&&a[b-i.r][d-i.c]===g)return!0}return!1}function o(a,d,e,f){var g,h,i=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}],j=b(f),k=c(f),l=[];for(g=0;g<i.length;g++)h=i[g],a[d+h.r]&&a[d+h.r][e+h.c]===k&&a[d+2*h.r]&&a[d+2*h.r][e+2*h.c]===j&&l.push({row:d+h.r,col:e+h.c});for(g=0;g<i.length;g++)h=i[g],a[d-h.r]&&a[d-h.r][e-h.c]===k&&a[d-2*h.r]&&a[d-2*h.r][e-2*h.c]===j&&l.push({row:d-h.r,col:e-h.c});return l}function p(c,d,g,h,i,j,k){void 0===c&&(c=a());var p=b(k);if(void 0===c[d]||c[d][g]!==p)throw new Error("One can only move his own pawn!");if(c[4][4]===p&&4!==d&&4!==g)throw new Error("One can only move his own pawn from the center block!");if(void 0===c[h]||""!==c[h][i])throw new Error("One can only make a move in an empty position.");if(""!==f(c,j)||e(c))throw new Error("One can only make a move if the game is not over!");if(!l(c,d,g,h,i,k))throw new Error("One can only make a one step move or jump once over opponent's pawn.");if(j&&j.length>0&&!m(c,h,i,j))throw new Error("One can only move a pawn to a captured pawn.");var q=angular.copy(c),r=!1,s={};if(j=[],q[d][g]="",4!==h||4!==i){if(n(c,h,i,k))q[h][i]="",j=[{row:h,col:i}],r=!0;else if(q[h][i]=p,j=o(q,h,i,k),0===j.length)r=!0;else for(var t=0;t<j.length;t++){var u=j[t];q[u.row][u.col]=""}var v=f(q,j);s=""!==v||e(q)?{endMatch:{endMatchScores:"R"===v?[1,0]:"B"===v?[0,1]:[0,0]}}:r?{setTurn:{turnIndex:1-k}}:{setTurn:{turnIndex:k}}}else s={setTurn:{turnIndex:k}},q[4][4]=p;return[s,{set:{key:"board",value:q}},{set:{key:"delta",value:{from_row:d,from_col:g,to_row:h,to_col:i}}},{set:{key:"captures",value:j}}]}function q(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.from_row,g=e.from_col,h=e.to_row,i=e.to_col,j=d.captures||[],k=d.board,l=p(k,f,g,h,i,j,c);if(!angular.equals(b,l))return!1}catch(m){return!1}return!0}return{getInitialBoard:a,createMove:p,isMoveOk:q,isTie:e,getWinner:f,checkMoveSteps:l,getPawnByTurn:b,getOppositePawnByTurn:c,getPossibleMoves:h,getValidFromPositions:j,getValidToPositions:k}}),angular.module("myApp").controller("gameController",["$scope","$log","$timeout","gameService","stateService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g){"use strict";function h(b,c,d){var e=j(),f=Math.min(Math.max(c-q.offsetLeft,0),q.clientWidth-e.width),g=Math.min(Math.max(d-q.offsetTop,0),q.clientHeight-e.height),h=Math.floor(r*g/q.clientHeight),m=Math.floor(s*f/q.clientWidth);if("touchstart"!==b||u||p(h,m)&&a.$apply(function(){t={row:h,col:m},u=document.getElementById("e2e_test_piece_"+t.row+"x"+t.col),u.style["z-index"]=v}),u){if("touchend"===b){var n=t,o={row:h,col:m};l(n,o)}else i(k(h,m));("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(w?setTimeout(function(){u.style.display="none",u.style.left="",u.style.top="",u.style.display="block",u=null},100):(u.style.left="",u.style.top="",u=null),t=null)}}function i(a){var b=k(t.row,t.col),c=j();u.style.left=a.left-b.left+.15*c.width+"px",u.style.top=a.top-b.top+.15*c.height+"px"}function j(){return{width:q.clientWidth/s,height:q.clientHeight/r}}function k(a,b){var c=j();return{top:a*c.height,left:b*c.width}}function l(b,c){p(c.row,c.col),a.$apply()}function m(){var b=f.getPossibleMoves(a.board,a.captures,a.turnIndex);d.makeMove(b[Math.floor(Math.random()*b.length)])}function n(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta,a.captures=b.stateAfterMove.captures||[],void 0===a.board&&(a.board=f.getInitialBoard(),a.rotate="playBlack"===b.playMode?!0:!1),a.validFromPositions=f.getValidFromPositions(a.board,a.captures,b.turnIndexAfterMove),a.selectedBlock&&4===a.selectedBlock.row&&4===a.selectedBlock.col&&(a.validToPositions=f.getValidToPositions(a.board,4,4,a.captures,a.turnIndex)),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(m,500))}function o(b,c){for(var d=0;d<a.validFromPositions.length;d++){var e=a.validFromPositions[d];if(b===e.row&&c===e.col)return!0}return!1}function p(c,e){if(a.rotate&&(c=8-c,e=8-e),b.info(["Clicked on cell:",c,e,a.isYourTurn]),!a.isYourTurn)return!1;if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(o(c,e))a.selectedBlock={row:c,col:e},a.validToPositions=f.getValidToPositions(a.board,c,e,a.captures,a.turnIndex);else if(null!==a.selectedBlock)try{var g=a.selectedBlock,h=f.createMove(a.board,g.row,g.col,c,e,a.captures,a.turnIndex);4===c&&4===e?a.selectedBlock={row:4,col:4}:(a.selectedBlock=null,a.validToPositions=[]),w=!0,a.isYourTurn=!1,d.makeMove(h)}catch(i){return b.info(["Cell is already full in position:",c,e]),!1}return!0}var q=document.getElementById("gameArea"),r=9,s=9,t=null,u=null,v=81,w=!1;window.handleDragEvent=h,a.selectedBlock=null,a.validToPositions=[],g.setWidthToHeight(1),window.e2e_test_stateService=e,a.getBlockClass=function(b,c){a.rotate&&(b=8-b,c=8-c);var d=["block"];if("-"===a.getPiece(b,c))d.push("empty");else{4===b&&4===c&&d.push("center"),a.selectedBlock&&a.selectedBlock.row===b&&a.selectedBlock.col===c&&d.push("selected");var e,g;if(o(b,c))d.push("valid");else for(e=0;e<a.validToPositions.length;e++)if(g=a.validToPositions[e],b===g.row&&c===g.col){d.push("validTo");break}for(e=0;e<a.captures.length;e++)g=a.captures[e],b===g.row&&c===g.col&&d.push("captured",f.getOppositePawnByTurn(a.turnIndex))}return d},a.getPiece=function(b,c){return a.rotate&&(b=8-b,c=8-c),a.board[b][c]},d.setGame({gameDeveloperEmail:"jugalm9@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:n})}]);
//# sourceMappingURL=everything.min.js.map