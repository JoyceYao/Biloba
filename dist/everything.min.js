angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).factory("gameLogic",function(){"use strict";function a(){return[["-","-","","","B","","","-","-"],["-","","","B","B","B","","","-"],["","","B","B","B","B","B","",""],["","B","B","B","B","B","B","B",""],["","","","","","","","",""],["","R","R","R","R","R","R","R",""],["","","R","R","R","R","R","",""],["-","","","R","R","R","","","-"],["-","-","","","R","","","-","-"]]}function b(a){return 0===a?"R":"B"}function c(a){return 0===a?"B":"R"}function d(a){for(var b=[0,0],c=0;9>c;c++)for(var d=a[c],e=0;9>e;e++)"R"===d[e]?b[0]++:"B"===d[e]&&b[1]++;return b}function e(a){var b=d(a);return b[0]<3&&b[1]<3?!0:!1}function f(a,c,e){var f=d(a);if(c.length>0){if(f[1-e]<3)for(var g=0;g<c.length;g++)if(!o(a,c[g].row,c[g].col,e))return b(e);return""}return f[0]>=3&&f[1]>=3?"":f[0]>=3&&f[1]<3?"B":f[1]>=3&&f[0]<3?"R":void 0}function g(a,b,c,d,e){for(var f=[],g=Math.max(b-2,0),h=Math.min(b+2,8),i=Math.max(c-2,0),j=Math.min(c+2,8),k=g;h>=k;k++)for(var l=i;j>=l;l++)try{var m=r(a,b,c,k,l,d,e);f.push(m)}catch(n){}return f}function h(a,c,d){var e,f,h=[],i=b(d);for(e=0;9>e;e++)for(f=0;9>f;f++)a[e][f]===i&&(h=h.concat(g(a,e,f,c,d)));return h}function i(a,c,d){for(var e=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}],f=[],g=b(d),h=0;h<c.length;h++)for(var i=c[h].row,j=c[h].col,k=0;k<e.length;k++){var l=e[k],m=i+l.r,n=j+l.c,o=i-l.r,p=j-l.c;a[m]&&a[m][n]===g&&a[o]&&a[o][p]===g&&f.push({row:m,col:n},{row:o,col:p})}return f}function j(a,c,d){var e=b(d),f=[];if(a[4][4]===e)return[{row:4,col:4}];if(c.length>0)return i(a,c,d);for(var g=0;9>g;g++)for(var h=0;9>h;h++)a[g][h]===e&&f.push({row:g,col:h});return f}function k(a,b,c,d,e){for(var f=j(a,d,e),g=0;g<f.length;g++){var h=f[g];if(b===h.row&&c===h.col)return!0}return!1}function l(a,b,c,d,e){for(var f=g(a,b,c,d,e),h=[],i=0;i<f.length;i++){var j=f[i];h.push({row:j[2].set.value.to_row,col:j[2].set.value.to_col})}return h}function m(a,b,d,e,f,g){var h=e-b,i=f-d,j=0===h?0:h/Math.abs(h),k=0===i?0:i/Math.abs(i),l=b+j,m=d+k;if(Math.abs(h)>1||Math.abs(i)>1){var n=h+i;return 4>=n&&n%2===0&&a[l]&&a[l][m]===c(g)?!0:!1}return!0}function n(a,b,c,d){for(var e=0;e<d.length;e++){var f=d[e];if(b===f.row&&c===f.col)return!0}return!1}function o(a,b,d,e){for(var f=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}],g=c(e),h=0;h<f.length;h++){var i=f[h];if(a[b+i.r]&&a[b+i.r][d+i.c]===g&&a[b-i.r]&&a[b-i.r][d-i.c]===g)return!0}return!1}function p(a,c,d,e,f){var g=[],h=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}];if(e.length>0)for(var i=0;i<e.length;i++){var j=e[i];o(a,j.row,j.col,f)&&g.push({row:j.row,col:j.col});for(var k=0;k<h.length;k++){var l=h[k],m=j.row+l.r,n=j.row-l.r,p=j.col+l.c,q=j.col-l.c;a[m][p]===b(f)&&o(a,m,p,f)?g.push({row:m,col:p}):a[n][q]===b(f)&&o(a,n,q,f)&&g.push({row:n,col:q})}}else o(a,c,d,f)&&g.push({row:c,col:d});return g}function q(a,d,e,f){var g,h,i=[{r:0,c:1},{r:1,c:1},{r:1,c:0},{r:1,c:-1}],j=b(f),k=c(f),l=[];for(g=0;g<i.length;g++)h=i[g],a[d+h.r]&&a[d+h.r][e+h.c]===k&&a[d+2*h.r]&&a[d+2*h.r][e+2*h.c]===j&&l.push({row:d+h.r,col:e+h.c});for(g=0;g<i.length;g++)h=i[g],a[d-h.r]&&a[d-h.r][e-h.c]===k&&a[d-2*h.r]&&a[d-2*h.r][e-2*h.c]===j&&l.push({row:d-h.r,col:e-h.c});return l}function r(c,d,g,h,i,j,l){void 0===c&&(c=a());var o=b(l);if(void 0===c[d]||c[d][g]!==o)throw new Error("One can only move his own pawn!");if(c[4][4]===o&&4!==d&&4!==g)throw new Error("One can only move his own pawn from the center block!");if(void 0===c[h]||""!==c[h][i])throw new Error("One can only make a move in an empty position.");if(""!==f(c,j,l)||e(c))throw new Error("One can only make a move if the game is not over!");if(!k(c,d,g,j,l))throw new Error("One can only capture using one of the capturing pawns.");if(!m(c,d,g,h,i,l))throw new Error("One can only make a one step move or jump once over opponent's pawn.");if(j&&j.length>0&&!n(c,h,i,j))throw new Error("One can only move a pawn to a captured pawn.");var r,s=angular.copy(c),t=!1,u={};s[d][g]="";var v=q(s,h,i,l),w=p(s,h,i,j,l);if(j=[],4!==h||4!==i){if(s[h][i]=o,w.length>0&&0===v.length){for(r=0;r<w.length;r++)s[w[r].row][w[r].col]="";j=w,t=!0}else if(j=v,0===j.length)t=!0;else for(r=0;r<j.length;r++){var x=j[r];s[x.row][x.col]=""}var y=f(s,j,l);u=""!==y||e(s)?{endMatch:{endMatchScores:"R"===y?[1,0]:"B"===y?[0,1]:[0,0]}}:t?{setTurn:{turnIndex:1-l}}:{setTurn:{turnIndex:l}}}else u={setTurn:{turnIndex:l}},s[4][4]=o;return[u,{set:{key:"board",value:s}},{set:{key:"delta",value:{from_row:d,from_col:g,to_row:h,to_col:i}}},{set:{key:"captures",value:j}}]}function s(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.from_row,g=e.from_col,h=e.to_row,i=e.to_col,j=d.captures||[],k=d.board,l=r(k,f,g,h,i,j,c);if(!angular.equals(b,l))return!1}catch(m){return!1}return!0}return{getInitialBoard:a,createMove:r,isMoveOk:s,isTie:e,getWinner:f,checkMoveSteps:m,getPawnByTurn:b,getOppositePawnByTurn:c,getPossibleMoves:h,getValidFromPositions:j,getValidToPositions:l}}),angular.module("myApp").controller("gameController",["$rootScope","$scope","$log","$timeout","gameLogic",function(a,b,c,d,e){"use strict";function f(a,c,d){var e=h(),f=Math.min(Math.max(c-o.offsetLeft,0),o.clientWidth-e.width),k=Math.min(Math.max(d-o.offsetTop,0),o.clientHeight-e.height),l=Math.floor(p*k/o.clientHeight),m=Math.floor(q*f/o.clientWidth);if("touchstart"!==a||s||n(l,m)&&b.$apply(function(){r={row:l,col:m},s=document.getElementById("e2e_test_piece_"+r.row+"x"+r.col),s.style["z-index"]=t}),s){if("touchend"===a){var v=r,w={row:l,col:m};j(v,w)}else g(i(l,m));("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(u?setTimeout(function(){s.style.display="none",s.style.left="",s.style.top="",s.style.display="block",s=null},100):(s.style.left="",s.style.top="",s=null),r=null)}}function g(a){var b=i(r.row,r.col),c=h();s.style.left=a.left-b.left+.15*c.width+"px",s.style.top=a.top-b.top+.15*c.height+"px"}function h(){return{width:o.clientWidth/q,height:o.clientHeight/p}}function i(a,b){var c=h();return{top:a*c.height,left:b*c.width}}function j(a,c){n(c.row,c.col),b.$apply()}function k(){var a=e.getPossibleMoves(b.board,b.captures,b.turnIndex);gameService.makeMove(a[Math.floor(Math.random()*a.length)])}function l(a){b.board=a.stateAfterMove.board,b.delta=a.stateAfterMove.delta,b.captures=a.stateAfterMove.captures||[],void 0===b.board&&(b.board=e.getInitialBoard(),b.rotate="playBlack"===a.playMode?!0:!1),b.validFromPositions=e.getValidFromPositions(b.board,b.captures,a.turnIndexAfterMove),b.selectedBlock&&4===b.selectedBlock.row&&4===b.selectedBlock.col&&(b.validToPositions=e.getValidToPositions(b.board,4,4,b.captures,b.turnIndex)),b.isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,b.turnIndex=a.turnIndexAfterMove,b.isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&(b.isYourTurn=!1,d(k,500))}function m(a,c){for(var d=0;d<b.validFromPositions.length;d++){var e=b.validFromPositions[d];if(a===e.row&&c===e.col)return!0}return!1}function n(a,d){if(b.rotate&&(a=8-a,d=8-d),c.info(["Clicked on cell:",a,d,b.isYourTurn]),!b.isYourTurn)return!1;if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(m(a,d))b.selectedBlock={row:a,col:d},b.validToPositions=e.getValidToPositions(b.board,a,d,b.captures,b.turnIndex);else if(null!==b.selectedBlock)try{var f=b.selectedBlock,g=e.createMove(b.board,f.row,f.col,a,d,b.captures,b.turnIndex);4===a&&4===d?b.selectedBlock={row:4,col:4}:(b.selectedBlock=null,b.validToPositions=[]),u=!0,b.isYourTurn=!1,gameService.makeMove(g)}catch(h){return c.info(["Cell is already full in position:",a,d]),!1}return!0}var o=document.getElementById("gameArea"),p=9,q=9,r=null,s=null,t=81,u=!1;dragAndDropService.addDragListener("gameArea",f),b.selectedBlock=null,b.validToPositions=[],resizeGameAreaService.setWidthToHeight(1),window.e2e_test_stateService=stateService,b.getBlockClass=function(a,c){b.rotate&&(a=8-a,c=8-c);var d=["block"];if("-"===b.getPiece(a,c))d.push("empty");else{4===a&&4===c&&d.push("center"),b.selectedBlock&&b.selectedBlock.row===a&&b.selectedBlock.col===c&&d.push("selected");var f,g;if(m(a,c))d.push("valid");else for(f=0;f<b.validToPositions.length;f++)if(g=b.validToPositions[f],a===g.row&&c===g.col){d.push("validTo");break}for(f=0;f<b.captures.length;f++)g=b.captures[f],a===g.row&&c===g.col&&d.push("captured",e.getOppositePawnByTurn(b.turnIndex))}return d},b.getPiece=function(a,c){return b.rotate&&(a=8-a,c=8-c),b.board[a][c]},gameService.setGame({gameDeveloperEmail:"jugalm9@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:e.isMoveOk,updateUI:l})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(b,c,g,h){return a.alphaBetaDecision([null,{set:{key:"board",value:b}},null,{set:{key:"captures",value:c}}],g,e,d,"?debug"===window.location.search?f:null,h)}function d(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function e(a,c){var d=b.getPossibleMoves(a[1].set.value,a[3].set.value,c);return d}function f(a){return"\n"+a[1].set.value.join("\n")+"\n"}return{createComputerMove:c}}]);
//# sourceMappingURL=everything.min.js.map